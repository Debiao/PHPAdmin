<?php /*a:3:{s:65:"/Users/sundebiao/PHPAdmin/application/admin/view/queue/index.html";i:1564341490;s:58:"/Users/sundebiao/PHPAdmin/application/admin/view/main.html";i:1564341490;s:72:"/Users/sundebiao/PHPAdmin/application/admin/view/queue/index_search.html";i:1564341490;}*/ ?>
<div class="layui-card layui-bg-gray"><?php if(!(empty($title) || (($title instanceof \think\Collection || $title instanceof \think\Paginator ) && $title->isEmpty()))): ?><div class="layui-card-header layui-anim layui-anim-fadein notselect"><span class="layui-icon layui-icon-next font-s10 color-desc margin-right-5"></span><?php echo htmlentities((isset($title) && ($title !== '')?$title:'')); ?><div class="pull-right"><?php if(auth("admin/queue/remove")): ?><button data-action='<?php echo url("remove"); ?>' data-confirm="确定要删除这些任务吗？" data-rule="id#{key}" class='layui-btn layui-btn-sm layui-btn-primary'>删除任务</button><?php endif; ?></div></div><?php endif; ?><div class="layui-card-body layui-anim layui-anim-upbit"><div class="think-box-shadow"><?php if(session('admin_user.username') == 'admin'): ?><fieldset class="margin-bottom-10"><legend>进程守护</legend><div class="layui-code border-0 margin-top-0"><p class="color-desc margin-top-10">当前消息队列守护进程运行状态</p><?php echo (isset($message) && ($message !== '')?$message:'--'); ?><p class="color-desc margin-top-10">配置定时任务来检查并启动进程（建议每分钟执行）</p><?php echo htmlentities((isset($cmd) && ($cmd !== '')?$cmd:'--')); ?></div></fieldset><?php endif; ?><fieldset><legend>条件搜索</legend><form class="layui-form layui-form-pane form-search" action="<?php echo request()->url(); ?>" onsubmit="return false" method="get" autocomplete="off"><div class="layui-form-item layui-inline"><label class="layui-form-label">任务名称</label><div class="layui-input-inline"><input name="title" value="<?php echo htmlentities((app('request')->get('title') ?: '')); ?>" placeholder="请输入任务名称" class="layui-input"></div></div><div class="layui-form-item layui-inline"><label class="layui-form-label">任务指令</label><div class="layui-input-inline"><select class="layui-select" name="uri" lay-search><option value="">-- 全部指令 --</option><?php foreach($uris as $uri): ?><!--<?php if(app('request')->get('uri') == $uri): ?>--><option selected value="<?php echo htmlentities($uri); ?>"><?php echo htmlentities($uri); ?></option><!--<?php else: ?>--><option value="<?php echo htmlentities($uri); ?>"><?php echo htmlentities($uri); ?></option><!--<?php endif; ?>--><?php endforeach; ?></select></div></div><div class="layui-form-item layui-inline"><label class="layui-form-label">任务状态</label><div class="layui-input-inline"><select name="status" class="layui-select"><?php foreach([''=>'-- 全部状态 --','1'=>'待处理','2'=>'处理中','3'=>'处理完成','4'=>'处理失败'] as $k=>$v): ?><!--<?php if(app('request')->get('status') == $k): ?>--><option selected value="<?php echo htmlentities($k); ?>"><?php echo htmlentities($v); ?></option><!--<?php else: ?>--><option value="<?php echo htmlentities($k); ?>"><?php echo htmlentities($v); ?></option><!--<?php endif; ?>--><?php endforeach; ?></select></div></div><div class="layui-form-item layui-inline"><label class="layui-form-label">创建时间</label><div class="layui-input-inline"><input data-date-range name="create_at" value="<?php echo htmlentities((app('request')->get('create_at') ?: '')); ?>" placeholder="请选择创建时间" class="layui-input"></div></div><div class="layui-form-item layui-inline"><label class="layui-form-label">跟进时间</label><div class="layui-input-inline"><input data-date-range name="status_at" value="<?php echo htmlentities((app('request')->get('status_at') ?: '')); ?>" placeholder="请选择跟进时间" class="layui-input"></div></div><div class="layui-form-item layui-inline"><button class="layui-btn layui-btn-primary"><i class="layui-icon">&#xe615;</i> 搜 索</button></div></form></fieldset><script>form.render()</script><table class="layui-table margin-top-15" lay-skin="line"><?php if(!(empty($list) || (($list instanceof \think\Collection || $list instanceof \think\Paginator ) && $list->isEmpty()))): ?><thead><tr><th class='list-table-check-td think-checkbox'><input data-auto-none data-check-target='.list-check-box' type='checkbox'></th><th class='text-left nowrap'>任务信息</th><th class='text-left nowrap'>任务时间</th><th class='text-left nowrap'>任务状态</th></tr></thead><?php endif; ?><tbody><?php foreach($list as $key=>$vo): ?><tr><td class='list-table-check-td think-checkbox'><input class="list-check-box" value='<?php echo htmlentities($vo['id']); ?>' type='checkbox'></td><td class='text-left nowrap'>
                任务名称：<?php echo htmlentities($vo['title']); ?><br>
                任务指令：<?php echo htmlentities($vo['uri']); ?></td><td class='text-left nowrap'>
                创建时间：<?php echo format_datetime($vo['create_at']); ?><br>
                跟进时间：<?php echo format_datetime($vo['status_at']); ?></td><td class='text-left nowrap'>
                任务状态：<?php if($vo['double'] == '1'): ?><span class="layui-badge layui-bg-green margin-right-5">复</span><?php else: ?><span class="layui-badge layui-bg-blue margin-right-5">单</span><?php endif; if($vo['status'] == '1'): ?><span class="layui-badge layui-bg-black">待处理</span><?php elseif($vo['status'] == 2): ?><span class="layui-badge layui-bg-green">处理中</span><?php elseif($vo['status'] == 3): ?><span class="layui-badge layui-bg-blue">处理完成</span><?php elseif($vo['status'] == 4): ?><span class="layui-badge layui-bg-red margin-right-5">处理失败</span><a class="layui-badge layui-bg-green" data-tips-text="重置该任务" data-action="<?php echo url('redo'); ?>" data-value="id#<?php echo htmlentities($vo['id']); ?>"><i class="layui-icon font-s12">&#xe669;</i></a><?php endif; if(auth("admin/queue/remove") and in_array($vo['status'],[1,3,4])): ?><a data-action='<?php echo url("remove"); ?>' data-confirm="确定要删除该任务吗？" data-value="id#<?php echo htmlentities($vo['id']); ?>" data-tips-text="删除该任务" class='layui-badge layui-bg-red margin-left-5'><i class="layui-icon">&#xe640;</i></a><?php endif; ?><br>
                状态描述：<span class="color-desc"><?php echo (isset($vo['status_desc']) && ($vo['status_desc'] !== '')?$vo['status_desc']:"没有获取到状态描述"); ?></span></td></tr><?php endforeach; ?></tbody></table><?php if(empty($list) || (($list instanceof \think\Collection || $list instanceof \think\Paginator ) && $list->isEmpty())): ?><span class="notdata">没有记录哦</span><?php else: ?><?php echo (isset($pagehtml) && ($pagehtml !== '')?$pagehtml:''); ?><?php endif; ?></div></div></div>