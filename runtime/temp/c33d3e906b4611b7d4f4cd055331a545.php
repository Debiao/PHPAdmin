<?php /*a:5:{s:69:"/Users/sundebiao/PHPAdmin/application/wechat/view/config/options.html";i:1564341490;s:58:"/Users/sundebiao/PHPAdmin/application/admin/view/main.html";i:1564341490;s:73:"/Users/sundebiao/PHPAdmin/application/wechat/view/config/options_api.html";i:1564341490;s:73:"/Users/sundebiao/PHPAdmin/application/wechat/view/config/options_thr.html";i:1564341490;s:74:"/Users/sundebiao/PHPAdmin/application/wechat/view/config/options_help.html";i:1564341490;}*/ ?>
<div class="layui-card layui-bg-gray"><?php if(!(empty($title) || (($title instanceof \think\Collection || $title instanceof \think\Paginator ) && $title->isEmpty()))): ?><div class="layui-card-header layui-anim layui-anim-fadein notselect"><span class="layui-icon layui-icon-next font-s10 color-desc margin-right-5"></span><?php echo htmlentities((isset($title) && ($title !== '')?$title:'')); ?><div class="pull-right"></div></div><?php endif; ?><div class="layui-card-body layui-anim layui-anim-upbit"><div><div class="layui-card layui-form"><div class="layui-card-body think-box-shadow padding-bottom-5"><div class="layui-form-item margin-bottom-0"><label class="layui-form-label">Auth<br><span class="nowrap color-desc">授权方式</span></label><div class="layui-input-block"><?php foreach(['api'=>'公众号平台API模式','thr'=>'第三方平台授权模式','test'=>'接口功能测试'] as $k=>$v): ?><input type="radio" data-wechat-type="<?php echo htmlentities($k); ?>" name="wechat_type" value="<?php echo htmlentities($k); ?>" title="<?php echo htmlentities($v); ?>" lay-filter="wechat_type"><?php endforeach; ?><p class="help-block">请选择微信对接方式，其中第三方平台授权需要微信开放平台支持，同时需要搭建 SERVICE 服务！</p></div></div></div></div><div class="think-box-shadow "><div class="layui-anim layui-anim-upbit" data-type="api"><form onsubmit="return false;" data-auto="true" method="post" class='layui-form layui-card' autocomplete="off"><div class="layui-card-body"><div class="color-blue padding-left-40 padding-bottom-20">
            使用API直接对接时，需要在微信公众号平台配置授权IP及网页授权域名，另外再将获取到的参数填写到下面！
        </div><div class="layui-form-item"><label class="layui-form-label">Token<br><span class="nowrap color-desc">接口认证令牌</span></label><div class="layui-input-block"><input name="wechat_token" required placeholder="请输入消息推送对接认证Token（必填）" value="<?php echo sysconf('wechat_token'); ?>" class="layui-input"><p class="help-block">公众号平台与系统对接认证Token，请优先填写此参数并保存，然后再在微信公众号平台操作对接。</p></div></div><div class="layui-form-item"><label class="layui-form-label">AppId<br><span class="nowrap color-desc">公众号APPID</span></label><div class="layui-input-block"><input name="wechat_appid" placeholder="请输入以wx开头的18位公众号APPID（必填）" pattern="^wx[0-9a-z]{16}$" maxlength="18" required="required" value="<?php echo sysconf('wechat_appid'); ?>" class="layui-input"><p class="help-block">公众号APPID是所有接口必要参数，可以在公众号平台 [ 开发 > 基本配置 ] 页面获取。</p></div></div><div class="layui-form-item"><label class="layui-form-label">AppSecret<br><span class="nowrap color-desc">公众号Secret</span></label><div class="layui-input-block"><input name="wechat_appsecret" required placeholder="请输入32位公众号AppSecret（必填）" value="<?php echo sysconf('wechat_appsecret'); ?>" maxlength="32" pattern="^[0-9a-z]{32}$" class="layui-input"><p class="help-block">公众号应用密钥是所有接口必要参数，可以在公众号平台 [ 开发 > 基本配置 ] 页面授权后获取。</p></div></div><div class="layui-form-item"><label class="layui-form-label">EnAesKey<br><span class="nowrap color-desc">消息加密密钥</span></label><div class="layui-input-block"><input name="wechat_encodingaeskey" placeholder="请输入43位消息公众号加密密钥（可选）" value="<?php echo sysconf('wechat_encodingaeskey'); ?>" maxlength="43" pattern="^.{43}$" class="layui-input"><p class="help-block">若开启了消息加密时必需填写，消息加密密钥必需填写并保持与公众号平台一致。</p></div></div><div class="layui-form-item"><label class="layui-form-label margin-top-15">PushApiUrl<br><span class="nowrap color-desc">消息推送接收</span></label><div class="layui-input-block"><div class="relative"><input name="wechat_push_url" value="服务器授权IP：<?php echo htmlentities($geoip); ?>" readonly class="layui-input layui-bg-gray border-0"><a data-copy="<?php echo htmlentities($geoip); ?>" class="absolute layui-btn layui-bg-gray" style="top:0;right:0;background:none!important"><i class="fa fa-copy"></i></a></div><div class="relative margin-top-5"><input name="wechat_push_url" value="消息推送地址：<?php echo htmlentities($thrNotify); ?>" readonly class="layui-input layui-bg-gray border-0"><a data-copy="<?php echo htmlentities($thrNotify); ?>" class="absolute layui-btn layui-bg-gray" style="top:0;right:0;background:none!important"><i class="fa fa-copy"></i></a></div><p class="help-block">公众号服务平台消息推送接口及服务器授权IP地址，需在公众号接口开发处配置。</p></div></div><div class="hr-line-dashed"></div><div class="layui-form-item text-center"><input type="hidden" name="wechat_type" value="api"><button class="layui-btn" type="submit">保存配置</button></div></div></form></div><div class="layui-anim layui-anim-upbit" data-type="thr"><form onsubmit="return false" data-auto="true" method="post" class='layui-form layui-card' autocomplete="off"><div class="layui-card-body"><div class="color-blue padding-left-40 padding-bottom-20">
            使用第三方授权时，需要单独搭建 SERVICE 服务并将域名配置到 WECHAT 文件，二者需要使用 Yar 或 Soap 通信！
        </div><!--<?php if(!empty($wechat)): ?>--><div class="layui-form-item"><label class="layui-form-label">QRCode<br><span class="nowrap color-desc">公众号二维码</span></label><div class="layui-input-block"><div class="pull-left notselect"><img data-tips-image src="<?php echo htmlentities(local_image($wechat['qrcode_url'])); ?>" style="width:100px;margin-left:-7px"></div><div class="pull-left padding-left-10"><p class="nowrap">微信昵称：<?php echo htmlentities((isset($wechat['nick_name']) && ($wechat['nick_name'] !== '')?$wechat['nick_name']:'')); ?></p><p class="nowrap">微信类型：<?php if($wechat['service_type'] == 2): ?>服务号<?php elseif($wechat['service_type'] == 3): ?>小程序<?php else: ?>订阅号<?php endif; ?> / <?php echo $wechat['verify_type_info']==-1 ? '未认证'  :  '<span class="color-green">已认证</span>'; ?></p><p class="nowrap">注册公司：<?php echo htmlentities($wechat['principal_name']); ?></p><p class="nowrap">授权绑定：<?php echo htmlentities(format_datetime($wechat['create_at'])); ?></p></div></div></div><!--<?php endif; ?>--><div class="layui-form-item"><label class="layui-form-label">Authorize<br><span class="nowrap color-desc">公众号授权绑定</span></label><div class="layui-input-block"><button type="button" data-href="<?php echo htmlentities((isset($authurl) && ($authurl !== '')?$authurl:'')); ?>" class="layui-btn layui-btn-primary">重新绑定公众号</button><p class="help-block">点击连接将跳转到微信第三方平台进行公众号授权。</p></div></div><div class="layui-form-item"><label class="layui-form-label">AppId<br><span class="nowrap color-desc">公众号APPID</span></label><div class="layui-input-block"><input name="wechat_thr_appid" placeholder="请输入以wx开头的18位公众号APPID（必填）" pattern="^wx[0-9a-z]{16}$" maxlength="18" required value="<?php echo sysconf('wechat_thr_appid'); ?>" class="layui-input"><p class="help-block">众号 appid 通过微信第三方授权自动获取. 若没有值请进行微信第三方授权。</p></div></div><div class="layui-form-item"><label class="layui-form-label">AppKey<br><span class="nowrap color-desc">第三方服务密钥</span></label><div class="layui-input-block"><input name="wechat_thr_appkey" required placeholder="请输入32位公众号AppSecret（必填）" value="<?php echo sysconf('wechat_thr_appkey'); ?>" maxlength="32" pattern="^[0-9a-z]{32}$" class="layui-input"><p class="help-block">公众号服务平台接口密钥, 通过微信第三方授权自动获取, 若没有值请进行微信第三方授权。</p></div></div><div class="layui-form-item"><label class="layui-form-label">AppPushUri<br><span class="nowrap color-desc">第三方推送接口</span></label><div class="layui-input-block"><div class="relative margin-top-5"><input name="wechat_thr_appurl" value="消息推送地址：<?php echo htmlentities($thrNotify); ?>" readonly class="layui-input layui-bg-gray border-0"><a data-copy="<?php echo htmlentities($thrNotify); ?>" class="absolute layui-btn layui-bg-gray" style="top:0;right:0;background:none!important"><i class="fa fa-copy"></i></a></div><p class="help-block">公众号服务平台接口通知URL, 公众号消息接收与回复等。</p></div></div><div class="hr-line-dashed"></div><div class="layui-form-item text-center"><input type="hidden" name="wechat_type" value="thr"><button class="layui-btn" type="submit">保存配置</button></div></div></form></div><div class="layui-anim layui-anim-upbit" data-type="test"><form onsubmit="return false;" data-auto="true" method="post" class='layui-form layui-card padding-bottom-20' autocomplete="off"><div class="layui-card-body" style="padding-left:40px"><div class="layui-elem-quote border-0"><p class="font-s14 margin-bottom-10 color-text"><strong>第三方平台授权</strong><br>
                JSSDK签名测试需要在开放平台配置当前的授权域名：<a data-copy="<?php echo request()->host(); ?>"><?php echo request()->host(); ?></a></p><p class="font-s14 margin-bottom-10 color-text"><strong>普通接口强制绑定</strong><br>
                网页授权及JSSDK签名都需要在公众号平台配置授权域名：<a data-copy="<?php echo request()->host(); ?>"><?php echo request()->host(); ?></a></p><p class="font-s14 color-text"><strong>支付测试配置</strong><br>
                JSAPI支付测试需要在微信商户平台配置支付目录：<a data-copy="<?php echo url('@wechat/api.tools/','','',true); ?>"><?php echo url('@wechat/api.tools/','','',true); ?></a></p></div><div class="layui-clear"><div class="pull-left padding-right-15 notselect"><img class="notselect" data-tips-image src="<?php echo url('@wechat/api.tools/oauth_qrc'); ?>" style="width:120px"><p class="text-center">网页授权</p></div><div class="pull-left padding-left-0 padding-right-15"><img class="notselect" data-tips-image src="<?php echo url('@wechat/api.tools/jssdk_qrc'); ?>" style="width:120px;"><p class="text-center">JSSDK签名</p></div><div class="pull-left padding-left-0 padding-right-15"><img onerror="this.src='/static/theme/img/wechat/qrc_pay_error.jpg'" class="notselect" data-tips-image src="<?php echo url('@wechat/api.tools/jsapiqrc'); ?>" style="width:120px;"><p class="text-center">JSAPI支付</p></div><div class="pull-left padding-left-0 padding-right-15"><img onerror="this.src='/static/theme/img/wechat/qrc_pay_error.jpg'" class="notselect" data-tips-image src="<?php echo url('@wechat/api.tools/scanoneqrc'); ?>" style="width:120px;"><p class="text-center">扫码支付①</p></div><div class="pull-left padding-left-0"><img onerror="this.src='/static/theme/img/wechat/qrc_pay_error.jpg'" class="notselect" data-tips-image src="<?php echo url('@wechat/api.tools/scanqrc'); ?>" style="width:120px;"><p class="text-center">扫码支付②</p></div></div></div></form></div></div></div></div><script>
    $(function () {
        apply('<?php echo sysconf("wechat_type"); ?>');
        window.form.render();
        window.form.on('radio(wechat_type)', function (data) {
            apply(data.value);
        });

        function apply(value) {
            this.$active = $("[data-wechat-type='" + value + "']").trigger('click');
            if (this.$active.size() < 1) $("[data-wechat-type]:first").trigger('click');
            $('[data-type="' + value + '"]').show().siblings('[data-type]').hide();
        }
    });
</script></div>